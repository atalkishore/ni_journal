<div class="container mt-5">
  <h1 class="text-center mb-4">All Trades</h1>

  <div class="table-responsive">
    <table class="table table-striped table-bordered" id="trades-table">
      <thead class="thead-dark">
        <tr>
          <th>Stock Name</th>
          <th>Price</th>
          <th>Order Type</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

<script>
  function fetchTrades() {
    $.ajax({
      url: "/trade/api/trades",
      type: "GET",
      success: function (trades) {
        const tbody = $("#trades-table tbody");
        tbody.empty();

        trades.forEach((trade, index) => {
          const row = `
              <tr id="trade-${index}">
                <td>${trade.stockName}</td>
                <td>${trade.price}</td>
                <td>
                  <span class="badge ${
                    trade.orderType === "buy" ? "bg-success" : "bg-danger"
                  }">
                    ${
                      trade.orderType.charAt(0).toUpperCase() +
                      trade.orderType.slice(1)
                    }
                  </span>
                </td>
                <td>
                  <button 
                    class="btn btn-outline-danger btn-sm delete-trade" 
                    data-index="${index}"
                  >
                    Delete
                  </button>
                </td>
              </tr>`;
          tbody.append(row);
        });
      },
      error: function () {
        alert("Failed to fetch trades. Please try again.");
      },
    });
  }

  $(document).on("click", ".delete-trade", function (e) {
    e.preventDefault();

    const index = $(this).data("index");
    console.log("Attempting to delete trade at index:", index);

    if (confirm("Are you sure you want to delete this trade?")) {
      $.ajax({
        url: "/trade/api/trade-del",
        type: "DELETE",
        contentType: "application/json",
        data: JSON.stringify({ index }),
        success: function (response) {
          alert(response.message);
          fetchTrades();
        },
        error: function () {
          alert("Failed to delete trade. Please try again.");
        },
      });
    }
  });

  $(document).ready(function () {
    fetchTrades();
  });
</script>
