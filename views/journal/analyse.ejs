<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Analyse</title>
  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" 
    rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.3/dist/echarts.min.js"></script>
</head>
<body>
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-3">
        <%- include('../partials/_Sidebar.ejs') %>
      </div>

      <div class="col-md-7">
        <div class="container mt-5">
          <h1 class="text-center mb-5">Profit/Loss Analysis</h1>

          <div class="d-flex justify-content-center mb-4">
            <div class="d-flex align-items-center me-3">
              <div class="legend-box bg-danger"></div>
              <span>Loss</span>
            </div>
            <div class="d-flex align-items-center me-3">
              <div class="legend-box bg-success-light"></div>
              <span>Low Profit</span>
            </div>
            <div class="d-flex align-items-center">
              <div class="legend-box bg-success-dark"></div>
              <span>High Profit</span>
            </div>
          </div>

          <div class="border p-4 rounded shadow-sm">
            <div id="profitLossHeatmap" style="min-height:350px;" class="echart-heatmap-chart-example"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    .legend-box {
      width: 20px;
      height: 20px;
      margin-right: 8px;
      border-radius: 3px;
    }
    .graph-container {
      display: flex;
      flex-wrap: wrap;
      gap: 70px;
    }
    .graph-box {
      width: 20px;
      height: 20px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .graph-box:hover {
      transform: scale(1.1);
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
    }
    .bg-success-light {
      background-color: #90EE90 !important; 
    }
    .bg-success-dark {
      background-color: #006400 !important; 
    }
    .bg-danger {
      background-color: #f00 !important; 
    }
    .border {
      border: 2px solid #ddd;
      background-color: #f9f9f9;
    }
    .shadow-sm {
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      var chartDom = document.getElementById('profitLossHeatmap');
      var myChart = echarts.init(chartDom);

      var data = [
        [0, 0, 10],  
        [0, 1, -5],  
                [0, 2, 20], 
        [1, 0, -10],
        [1, 1, 15],  
        [1, 2, 5],  
        [2, 0, 30], 
        [2, 1, -2],  
        [2, 2, 40],  
      ];

      var option = {
        tooltip: {
          position: 'top',
          formatter: function (params) {
            var value = params.value[2];
            return value > 0 ? `Profit: $${value}` : `Loss: $${Math.abs(value)}`;
          }
        },
        grid: {
          left: '10%',
          right: '10%',
          bottom: '10%',
          top: '10%',
        },
        xAxis: {
          type: 'category',
          data: ['Stock A', 'Stock B', 'Stock C'],
          splitArea: { show: true },
        },
        yAxis: {
          type: 'category',
          data: ['Trade 1', 'Trade 2', 'Trade 3'],
          splitArea: { show: true },
        },
        visualMap: {
          min: -20, 
          max: 50, 
          dimension: 2,
          orient: 'horizontal',
          left: 'center',
          bottom: '5%',
          inRange: {
            color: ['#f00', '#90EE90', '#006400'], 
          },
          text: ['High Profit', 'Low Profit', 'Loss'],
        },
        series: [{
          name: 'Profit/Loss',
          type: 'heatmap',
          data: data,
          label: {
            show: true,
            position: 'inside',
            formatter: function (params) {
              var value = params.value[2];
              return value > 0 ? `+$${value}` : `-$${Math.abs(value)}`;
            }
          },
          emphasis: {
            itemStyle: {
              borderColor: '#000',
              borderWidth: 1,
              shadowBlur: 10,
            }
          }
        }]
      };

      myChart.setOption(option);
    });
  </script>
</body>
</html>
